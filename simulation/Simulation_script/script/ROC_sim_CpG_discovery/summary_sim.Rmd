---
title: "quick_simulation_res"
output: html_document
date: "2025-02-18"
---

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```
## Simulation Summary

We investigate the "CpG" mapping performance of different methods.

### Simulation Procedure

1. Simulate a univariate covariate \( X \) from a \( N(0,1) \) distribution with \( N = 100 \) or \( 200 \).
2. Simulate \( 2^S \) CpGs (64 or 128), where 5 or 10 CpGs are affected by \( X \).
3. \( X \) affects all CpGs in a similar fashion with \( h^2 = 1\% \), \( 5\% \), or \( 10\% \).

Below, we evaluate the performance of different methods based on:

1. **Univariate p-values**: One p-value per CpG-\( X \) association test.
2. **Local False Sign Rate (LFSR) from HMM regression**: One LFSR value per CpG-\( X \) association.
3. **Z-score from wavelet regression**: Defined as the ratio of the wavelet function estimate at a given CpG to the width of the 95% credible interval.

---

## Remarks / Results

1. **HMM LFSR** appears to be the best overall performer, maintaining strong performance across all \( h^2 \) values (1% to 10%).
2. **Wavelet Z-score** may perform poorly in high-noise settings but improves when the signal-to-noise ratio is moderate to high, particularly when 10 CpGs are affected.
3. **Univariate p-values** can outperform the wavelet Z-score in high-noise settings but do not perform as well as HMM LFSR. However, when the signal-to-noise ratio is moderate to high, the wavelet Z-score surpasses univariate p-values.

# total number of CPGs=64 
### N=100 simulations

```{r cars, echo=FALSE, warning=FALSE}
load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_01_n100_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR 
                              ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P11= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=100, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_01_n100_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti) 
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P12= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=100, naffect=10")+xlim(c(0,0.25))






load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_05_n100_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P21= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=100, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_05_n100_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P22= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=100, naffect=10")+xlim(c(0,0.25))








load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_10_n100_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P31= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=100, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_10_n100_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P32= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=100, naffect=10")+xlim(c(0,0.25))




 

grid.arrange(P11,P12,
             P21,P22,
             P31,P32, 
             ncol=2)


 
```



### N=200 simulations
 

```{r  , echo=FALSE, warning=FALSE}
load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_01_n200_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR 
),
FPR=  c(roc0$FPR,
        roc1$FPR,
        roc2$FPR ),
col=factor(c( rep( "pv", length(roc0$FPR )),
              rep( "hmm", length(roc1$FPR )),
              rep( "Zscore", length(roc1$FPR )) )
)
)

P11= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=200, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_01_n200_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti) 
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P12= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=200, naffect=10")+xlim(c(0,0.25))






load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_05_n200_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P21= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=200, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_05_n200_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P22= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=200, naffect=10")+xlim(c(0,0.25))








load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_10_n200_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P31= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=200, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/64/h2_10_n200_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P32= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=200, naffect=10")+xlim(c(0,0.25))






grid.arrange(P11,P12,
             P21,P22,
             P31,P32, 
             ncol=2)



```

# total number of CPGs=128 
### N=100 simulations




```{r echo=FALSE, warning=FALSE}
load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_01_n100_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P11= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=100, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_01_n100_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P12= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=100, naffect=10")+xlim(c(0,0.25))






load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_05_n100_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P21= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=100, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_05_n100_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P22= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=100, naffect=10")+xlim(c(0,0.25))








load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_10_n100_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P31= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=100, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_10_n100_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P32= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=100, naffect=10")+xlim(c(0,0.25))

grid.arrange(P11,P12,
             P21,P22,
             P31,P32, 
             ncol=2)

```

### N=200 simulations




```{r echo=FALSE, warning=FALSE}
load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_01_n200_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P11= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=200, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_01_n200_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P12= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=1%, n=200, naffect=10")+xlim(c(0,0.25))






load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_05_n200_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)


P21= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=200, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_05_n200_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P22= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=5%, n=200, naffect=10")+xlim(c(0,0.25))








load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_10_n200_CpG_5.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P31= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=200, naffect=5")+xlim(c(0,0.25))


load("D:/Document/Serieux/Travail/Data_analysis_and_papers/fsusie-experiments/simulation/Simulation_script/script/ROC_sim_CpG_discovery/h2_10_n200_CpG_10.RData")
library( ggplot2)
library(cowplot)
library(gridExtra)
res= do.call( rbind, res)



simple_roc <- function(labs, scores){
  labs <- labs[order(scores, decreasing=TRUE)]
  data.frame(TPR=cumsum(labs)/sum(labs), FPR=cumsum(!labs)/sum(!labs), labs)
}

#usage 
roc0 <- simple_roc(res$CpG,   res$pv)
roc1 <- simple_roc(res$CpG, res$hmm_lfsr)
roc2 <- simple_roc(res$CpG,res$pv_ti)
roc3 <- simple_roc(res$CpG,1-res$affected_TI)
df_plot = data.frame (TPR= c(roc0$TPR,
                             roc1$TPR,
                             roc2$TPR ),
                      FPR=  c(roc0$FPR,
                              roc1$FPR,
                              roc2$FPR ),
                      col=factor(c( rep( "pv", length(roc0$FPR )),
                                    rep( "hmm", length(roc1$FPR )),
                                    rep( "Zscore", length(roc1$FPR )) )
                      )
)

P32= ggplot(df_plot, aes(x=TPR, y=FPR, col=col))+geom_line()+
  theme_cowplot()+xlab("FDR")+ylab("Power")+
  ggtitle(" h2=10%, n=200, naffect=10")+xlim(c(0,0.25))





grid.arrange(P11,P12,
             P21,P22,
             P31,P32, 
             ncol=2)
```

